var util = require('util');
var tool = require('leaptool');

module.exports = function(app, moduleName, dataModule) {

    var data = dataModule;
    var block = { data:dataModule };
    var page = {};
    
    block.getIndex = function(req, res) {
        var page = { moduleName:moduleName };
        res.render(moduleName + '/index', { page:page });
    };
    
    block.add = function(req, res) {
        var page = { moduleName:moduleName };
        res.render(moduleName + '/add', { page:page });
    };
    
    // url: /:moduleName/page/:pagename
    block.showPage = function(req, res) {
        var parameter = tool.getReqParameter(req);
        var pagename = parameter.pagename || '';
        if (pagename) {
            pagename = pagename + '.html';
            res.render([moduleName, pagename].join('/'), {
                app: app, req: req
            });
        } else {
            var message = 'page name is not specified';
            app.renderInfoPage(null, [], { message:message }, req, res);
        }
    };

    // check if login
    block.checkLogin = function(req, res, next) {
        var loginUser = req.session && req.session.user;
        if (loginUser) {
            next();
        } else {
            var url = '/users/login?url=' + req.url;
            res.redirect(url);
        }
    };
    
    
    return block;

};
